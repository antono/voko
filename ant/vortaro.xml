<project name="Revo" default="test" basedir=".">
    <description>
       Reta Vortaro, reguloj por (re)krei gxin. 
    </description>

<!-- alstrebu dosierujo-strukturon tian:

fonto en:
 
  xml/art
  xml/dok
  xml/xsl

rezulto en:

  html/art
  html/inx
  html/dok

-->



  <!-- legu agorditajn variablojn el dosiero -->
  <property file="${user.dir}/cfg/agordo" prefix="mi."/>

  <!-- donu valorojn al la variabloj, se ili ne jam aperis en la agordo-dosiero -->
  <property name="mi.voko" location="/home/revo/voko"/>
  <property name="mi.voko.ant" location="${mi.voko}/ant"/>
  <property name="mi.bazo" location="${user.dir}"/>
  <property name="mi.bazo.dok" location="${mi.bazo}/dok"/>
  <property name="mi.bazo.cfg" location="${mi.bazo}/cfg"/>
  <property name="mi.bazo.dtd" location="${mi.bazo}/dtd"/>
  <property name="mi.bazo.stl" location="${mi.bazo}/stl"/>
  <property name="mi.bazo.smb" location="${mi.bazo}/smb"/>

  <property name="mi.bazo.xml" location="${mi.bazo}/xml"/>
  <property name="mi.bazo.art" location="${mi.bazo}/art"/>

  <property name="mi.voko.bin" location="${mi.voko}/bin"/>
  <property name="mi.voko.xsl" location="${mi.voko}/xsl"/>
  <property name="mi.voko.cfg" location="${mi.voko}/cfg"/>
  <property name="mi.voko.dok" location="${mi.voko}/dok"/>
  <property name="mi.voko.dtd" location="${mi.voko}/dtd"/>
  <property name="mi.voko.stl" location="${mi.voko}/stl"/>
  <property name="mi.voko.smb" location="${mi.voko}/smb"/>
  <!-- property name="tmp" location="/home/revo/tmp/inx_tmp"/ -->
  <property name="mi.tmp" location="${mi.bazo}/.tmp"/>
  <property name="mi.outputformat" value="html"/>

  <property name="saxon" location="/usr/local/lib/saxon/saxon8.jar"/>


  <target name="init">
    <!-- Create the time stamp -->
    <tstamp/>
    <!-- Create the build directory structure used by compile -->
    <mkdir dir="${mi.bazo.cfg}" />
    <mkdir dir="${mi.bazo.dok}" />
    <mkdir dir="${mi.bazo.dtd}" />
    <mkdir dir="${mi.bazo.stl}" />
    <mkdir dir="${mi.bazo.smb}" />
    <mkdir dir="${mi.bazo.xml}" />
    <mkdir dir="${mi.bazo.art}" />
  </target>


  <target name="agordo" description="eligas la agordeblajn variablojn por kontrolo">
    <echoproperties prefix="mi."/>
  </target>


  <target name="bib" depends="init"
        description="bibliografio" >

    <xslt in="${mi.voko.cfg}/bibliogr.xml" out="${mi.bazo.dok}/bibliogr.html"
      style="${mi.voko.xsl}/bibhtml.xsl"/>

    <xslt in="${mi.voko.cfg}/bibliogr.xml" out="${mi.bazo.dok}/biblaut.html"
      style="${mi.voko.xsl}/bibauthtml.xsl"/>

    <xslt in="${mi.voko.cfg}/bibliogr.xml" out="${mi.bazo.dok}/bibltit.html"
      style="${mi.voko.xsl}/bibtithtml.xsl"/>
  </target>

  <target name="dok" depends="init"
       description="diversaj dokumentoj">

    <copy todir="${mi.bazo.cfg}">
      <fileset dir="${mi.voko.cfg}" casesensitive="yes">
        <include name="*.xml"/>
      </fileset>
    </copy>

    <copy todir="${mi.bazo.dok}">
      <fileset dir="${mi.voko.dok}" casesensitive="yes">
        <include name="*.xml"/>
      </fileset>
    </copy>

    <xslt in="${mi.voko.dok}/manlibro.xml" out="${mi.bazo.dok}/manlibro.html"
       style="${mi.voko.xsl}/manlibro.xsl"/>

    <xslt in="${mi.voko.dok}/lingva_manlibro.xml" out="${mi.bazo.dok}/lingva_manlibro.html"
       style="${mi.voko.xsl}/manlibro.xsl"/>

<!--
    <exec dir="${revo}/dok" executable="perl">
       <arg file="${voko_bin}/dtd2html.pl"/>
       <arg file="${revo}/dtd/vokoxml.dtd"/>
    </exec>

    <exec dir="${revo}" executable="perl">
      <arg file="${voko_bin}/doklingv.pl"/>
    </exec>
-->

    <xslt in="${mi.voko.cfg}/fakoj.xml" out="${mi.bazo.dok}/fakoj.html"
       style="${mi.voko.xsl}/dok_fakoj.xsl"/>

    <xslt in="${mi.voko.cfg}/lingvoj.xml" out="${mi.bazo.dok}/lingvoj.html"
       style="${mi.voko.xsl}/dok_lingvoj.xsl"/>

    <xslt in="${mi.voko.cfg}/stiloj.xml" out="${mi.bazo.dok}/stiloj.html"
       style="${mi.voko.xsl}/dok_stiloj.xsl"/>

    <xslt in="${mi.voko.cfg}/mallongigoj.xml" out="${mi.bazo.dok}/mallongigoj.html"
       style="${mi.voko.xsl}/dok_mallongigoj.xsl"/>

  </target>


 <target name="dtd" depends="init"
       description="dokumenttip-difinoj">

    <copy todir="${mi.bazo.dtd}">
      <fileset dir="${mi.voko.dtd}" casesensitive="yes">
        <include name="*.dtd"/>
      </fileset>
    </copy>

  </target>

  <target name="stl" depends="init"
       description="kopias CSS-stildifinojn el voko">

    <copy todir="${mi.bazo.stl}">
      <fileset dir="${mi.voko.stl}" casesensitive="yes">
        <include name="*.*"/>
      </fileset>
    </copy>

  </target>

  <target name="smb" depends="init"
       description="kopias simbolojn el voko">

    <copy todir="${mi.bazo.smb}">
      <fileset dir="${mi.voko.smb}" casesensitive="yes">
        <include name="*.*"/>
      </fileset>
    </copy>

  </target>


  <target name="medio" depends="init,bib,dok,dtd,stl,smb"
     description="(re)kreas la medion por la vortaro, dosierujoj cfg,dok,dtd,stl,smb kun enhavo"/>


  <target name="html" depends="init" 
       description="(re)kreas indeksojn, tezauron kaj shanghitajn artikolojn en provizora dosierujo">
  
    <ant antfile="${mi.voko.ant}/tezauro.xml" inheritAll="false">   
       <property name="mi.bazo" location="${mi.bazo}"/>
       <target name="agordo"/>
       <target name="html"/>
    </ant>

    <ant antfile="${mi.voko.ant}/indeksoj.xml" inheritAll="false">   
       <property name="mi.bazo" location="${mi.bazo}"/>
       <target name="agordo"/>
       <target name="cvs-shanghoj"/>
       <target name="eraroj"/>
       <target name="html"/>
    </ant>

    <ant antfile="${mi.voko.ant}/artikoloj.xml" inheritAll="false">   
       <property name="mi.bazo" location="${mi.bazo}"/>
       <target name="agordo"/>
       <target name="html"/>
    </ant>

  </target>


  <target name="tuto" depends="init" 
       description="shovas (re)kreitajn indeksojn, tezauron kaj artikolojn el provizora dosierujo al la vortaro">
  
    <ant antfile="${mi.voko.ant}/tezauro.xml" target="mil" inheritAll="false">   
       <property name="mi.bazo" location="${mi.bazo}"/>
    </ant>

    <ant antfile="${mi.voko.ant}/indeksoj.xml" target="tuto" inheritAll="false">   
       <property name="mi.bazo" location="${mi.bazo}"/>
    </ant>

    <ant antfile="${mi.voko.ant}/artikoloj.xml" target="tuto" inheritAll="false">   
       <property name="mi.bazo" location="${mi.bazo}"/>
    </ant>

  </target>

</project>








