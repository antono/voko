<project name="Revo" default="test" basedir=".">
    <description>
       Reta Vortaro, reguloj por artikoloj.
    </description>

  <!-- legu agorditajn variablojn el dosiero -->
  <property file="${user.dir}/cfg/agordo" prefix="mi."/>

  <!-- donu valorojn al la variabloj, se ili ne jam aperis en la agordo-dosiero -->
  <property name="mi.voko" location="/home/revo/voko"/>
  <property name="mi.voko.ant" location="${mi.voko}/ant"/>
  <property name="mi.bazo" location="${user.dir}"/>
  <property name="mi.bazo.inx" location="${mi.bazo}/inx"/>
  <property name="mi.bazo.xml" location="${mi.bazo}/xml"/>
  <property name="mi.bazo.art" location="${mi.bazo}/art"/>
  <property name="mi.voko.bin" location="${mi.voko}/bin"/>
  <property name="mi.voko.xsl" location="${mi.voko}/xsl"/>
  <!-- property name="tmp" location="/home/revo/tmp/inx_tmp"/ -->
  <property name="mi.tmp" location="${mi.bazo}/.tmp"/>
  <property name="mi.outputformat" value="html"/>

  <property name="saxon" location="/usr/local/lib/saxon/saxon8.jar"/>


  <target name="art-preparo">
    <!-- Create the time stamp -->
    <tstamp/>
    <tstamp>
      <format property="mi.antau_jaro" pattern="MM/dd/yyyy hh:mm aa" offset="-1" unit="year"/>
    </tstamp>
    <!-- Create the build directory structure used by compile -->
    <mkdir dir="${mi.bazo.art}" />
    <mkdir dir="${mi.tmp}" />
    <mkdir dir="${mi.tmp}/art" />

    <!-- chu necesas refari la dosieron indekso.xml? -->
    <!-- uptodate property="indekso.aktuala">
      <srcfiles dir="${mi.bazo.xml}" includes="*.xml"/>
      <mapper type="merge" to="${mi.tmp}/indekso.xml"/>
    </uptodate -->

    <!-- evitu rekreadon de chiuj artikoloj pro shanghoj en la XSL-dosieroj -->
    <touch file="${mi.voko.xsl}/revo_tez.xsl" datetime="01/01/2000 0:00 pm"/>
    <touch file="${mi.voko.xsl}/revohtml2.xsl" datetime="01/01/2000 0:00 pm"/>
    <touch file="${mi.voko.xsl}/revohtml.xsl" datetime="01/01/2000 0:00 pm"/>

  </target>


  <target name="art-agordo" description="eligas la agordeblajn variablojn por kontrolo">
    <echoproperties prefix="mi."/>
  </target>


  <target name="art-html" depends="art-preparo" 
       description="kreas artikolojn el shanghitaj xml-dosieroj">

    <echo message="### enemtu tezauro-ligojn en chiujn aktualigitajn artikolojn"/>
    <xslt basedir="${mi.bazo.xml}" includes="*.xml" destdir="${mi.tmp}/art" extension=".xml"
       style="${mi.voko.xsl}/revo_tez.xsl"/>


    <!-- aktualigu kelkajn malnovajn dosierojn por certigi, ke shanghoj
         en la XSLT-dosieroj iom post iom trafos chiujn artikolojn -->
    <echo message="### aktualigu 5(0) malnovajn artikolojn"/>
    <xslt basedir="${mi.bazo.xml}" includes="*.xml" destdir="${mi.tmp}/art" extension=".xml"
       style="${mi.voko.xsl}/revo_tez.xsl" force="true">
        <custom classname="de.steloj.respiro.DateMaxFilesSelector" classpath="${mi.voko.ant}/respiro.jar">
          <param name="datetime" value="${mi.antau_jaro}"/>
          <param name="when" value="before"/>
          <param name="maxFiles" value="5"/> <!-- aktualigu maksimume 50 malnovajn dosierojn -->
        </custom>
    </xslt>

    <echo message="### kreu la HTML-dosierojn por la artikoloj"/>
    <xslt basedir="${mi.tmp}/art" includes="*.xml" destdir="${mi.tmp}/art/" extension=".html"
       style="${mi.voko.xsl}/revohtml2.xsl"/>


  </target>



  <target name="art-tuto" depends="art-html"
       description="kopias shanghitajn artikolojn al la destin-dosierujo">
    <copy todir="${mi.bazo.art}">
      <fileset dir="${mi.tmp}/art" includes="*.html">
        <different targetdir="${mi.bazo.art}" ignoreFileTimes="true"/>
      </fileset>
    </copy>
  </target>


   
  <target name="art-tricent" depends="art-html"
       description="kopias nur maksimume 300 shanghitajn artikolojn al la destin-dosierujo -->
  
    <copy todir="${mi.bazo.art}">
      <fileset dir="${mi.tmp}/art" includes="*.html">
        <custom classname="de.steloj.respiro.DiffMaxFilesSelector" classpath="${mi.voko.ant}/respiro.jar">
          <param name="targetDir" value="${mi.bazo.art}"/>
          <param name="ignoreFileTimes" value="true"/>
          <param name="maxFiles" value="300"/> <!-- aktualigu maksimume 300 artikolojn -->
        </custom>
      </fileset>
    </copy>

  </target>



</project>