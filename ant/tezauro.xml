<project name="Revo-indeksoj" default="tuto" basedir=".">
    <description>
       Reta Vortaro, reguloj por (re)krei tezauron. 
    </description>

  <!-- legu agorditajn variablojn el dosiero -->
  <property file="${user.dir}/cfg/agordo" prefix="mi."/>

  <!-- donu valorojn al la variabloj, se ili ne jam aperis en la agordo-dosiero -->
  <property name="mi.voko" location="/home/revo/voko"/>
  <property name="mi.voko.ant" location="${mi.voko}/ant"/>
  <property name="mi.bazo" location="${user.dir}"/>
  <!-- property name="mi.bazo.inx" location="${mi.bazo}/inx"/ -->
  <!-- property name="mi.bazo.xml" location="${mi.bazo}/xml"/ -->
  <property name="mi.tez" location="${mi.bazo}/tez"/>
  <property name="mi.voko.bin" location="${mi.voko}/bin"/>
  <property name="mi.voko.xsl" location="${mi.voko}/xsl"/>
  <!-- property name="tmp" location="/home/revo/tmp/inx_tmp"/ -->
  <property name="mi.tmp" location="${mi.bazo}/.tmp"/>
  <property name="mi.outputformat" value="html"/>

  <property name="saxon" location="/usr/local/lib/saxon/saxon8.jar"/>

  <!-- ial Formiko foje ne trovas Saxon per klaspado donita en la tasko mem,
      tial difinu mediovariablon CLASSPATH aldonante la Saxon-arkivon antau voki Formikon -->
  <path id="saxon.classpath">
     <pathelement location="${saxon}"/>
     <pathelement path="${java.class.path}"/>
  </path>


  <target name="init">
    <tstamp/>
  </target>


  <target name="agordo" description="eligas la agordeblajn variablojn por kontrolo">
    <echoproperties prefix="mi."/>
  </target>


  <target name="eltiro" description="faras la dosieron indekso.xml el chiuj artikoloj kiel bazo por la tezauro (vokas indekso.xml)" 
    depends="init">
    <ant antfile="${mi.voko.ant}/indeksoj.xml"
       dir="${mi.bazo}" target="eltiro" inheritAll="true"/>
  </target>

  <target name="forigu" 
      description="forigas chiujn dosierojn en ${mi.tmp}/tez"
      depends="init">
 
     <delete>
        <fileset dir="${mi.tmp}/tez" includes="*"/>
     </delete>
  </target>


  <target name="retigo" depends="init,eltiro"
     description="retigi la tezauronodojn">
     <xslt in="${mi.tmp}/indekso.xml" out="${mi.tmp}/tez_ret.xml"
       style="${mi.voko.xsl}/tez_retigo.xsl">
     </xslt>
  </target>


  <target name="html" depends="init,retigo"
     description="kreas la HTML-dosierojn de la tezauro">

    <filter token="format" value="${mi.outputformat}"/>
    <copy file="${mi.voko.xsl}/tez_html.xsl" tofile="${mi.voko.xsl}/tez_html_${mi.outputformat}.xsl~" 
       filtering="true"/>
     <xslt in="${mi.tmp}/tez_ret.xml" out="${mi.tmp}/tez/.tempo"
       style="${mi.voko.xsl}/tez_html_${mi.outputformat}.xsl~"/>
  </target>


  <target name="mil" depends="init,html"
     description="kopias fine maksimume mil shanghitajn dosierojn al la
     tezaurodosierujo kaj tie forigas forfalintajn">

    <copy todir="${mi.tez}">
      <fileset dir="${mi.tmp}/tez" includes="*">
        <!-- different targetdir="${mi.tez}" ignoreFileTimes="true"/ -->
        <custom classname="de.steloj.respiro.DiffMaxFilesSelector" classpath="${mi.voko.ant}/respiro.jar">
          <param name="targetDir" value="${mi.tez}"/>
          <param name="ignoreFileTimes" value="true"/>
          <param name="maxFiles" value="1000"/> <!-- aktualigu maksimume 1000 dosierojn de la tezauro -->
        </custom>
      </fileset>
    </copy>

    <delete>
      <fileset dir="${mi.tez}" includes="*">
         <present present="srconly" targetdir="${mi.tmp}/tez"/>
      </fileset>
    </delete>

  </target>


  <target name="tuto" depends="init,html"
     description="kopias fine chiujn enhave shanghitajn dosierojn al la
     tezaurodosierujo kaj tie forigas forfalintajn">

    <copy todir="${mi.tez}">
      <fileset dir="${mi.tmp}/tez" includes="*">
        <different targetdir="${mi.tez}" ignoreFileTimes="true"/>
      </fileset>
    </copy>

    <delete>
      <fileset dir="${mi.tez}" includes="*">
         <present present="srconly" targetdir="${mi.tmp}/tez"/>
      </fileset>
    </delete>

  </target>

</project>











